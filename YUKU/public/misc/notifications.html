<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>System Notifications Dashboard</title>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Roboto Mono', monospace; background-color: #1a1a1a; color: #e0e0e0; }
  .glass-panel { background: rgba(42,42,42,0.85); backdrop-filter: blur(10px); border: 1px solid #444; }
  .notif-badge { position: absolute; top: 0; right: 0; background: #00ff7f; color: #000; font-size: 0.65rem; width: 1.2rem; height: 1.2rem; display:flex; justify-content:center; align-items:center; border-radius:9999px; }
</style>
</head>
<body class="h-screen flex flex-col">

<!-- HEADER -->
<header class="glass-panel p-4 flex justify-between items-center">
  <h1 class="text-xl font-bold">System Dashboard</h1>
  <div class="relative">
    <button id="notificationBtn" class="p-2 hover:bg-gray-700 rounded-md transition">
      <svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
      </svg>
    </button>
    <span id="notifCount" class="notif-badge hidden">0</span>
  </div>
</header>

<!-- MAIN CONTENT -->
<main class="flex-grow p-6 overflow-auto">
  <h2 class="text-green-500 text-2xl mb-4">Welcome!</h2>
  <p>Click the bell icon to send a test system notification to your device.</p>
  <div id="notifLog" class="mt-6 space-y-2"></div>
</main>

<script>
$(document).ready(function(){
    const API_BASE_URL = "https://giant-noell-pixelart002-1c1d1fda.koyeb.app/webpush";
    const authToken = localStorage.getItem('authToken');
    let count = 0;

    if (!authToken) {
        alert("Auth token not found in localStorage!");
    }

    // Send test notification
    $('#notificationBtn').click(function(){
        $.ajax({
            async: true,
            crossDomain: true,
            url: `${API_BASE_URL}/send-test`,
            method: 'POST',
            headers: {
                Authorization: `Bearer ${authToken}`
            },
            success: function(response){
                count++;
                $('#notifCount').text(count).removeClass('hidden');
                $('#notifLog').prepend(`<div class="p-2 bg-gray-800 rounded-md border border-gray-600">✅ Notification sent: ${response.message}</div>`);
            },
            error: function(xhr){
                let errMsg = xhr.responseJSON?.detail || xhr.statusText;
                $('#notifLog').prepend(`<div class="p-2 bg-red-800 rounded-md border border-gray-600">❌ Failed to send notification: ${errMsg}</div>`);
            }
        });
    });
});
</script>

</body>
</html>